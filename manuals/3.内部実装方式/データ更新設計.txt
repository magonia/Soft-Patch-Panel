■概要
本テキストでは下記3点について検討した結果を記載する。
3点は制御機能への追加を行う。(新規機能部を用意すると、制御機能から移動が必要となる処理が必要な為。)

(1)コマンド受付後の管理情報の更新方法
(2)SPPコンポーネントが管理情報を取得するIF
(3)面切り替え(Sprint4では省略)

なお、後述しているAPIについては、
それぞれ別に記載しているが、必要なAPIを並べて記載ているだけで、
特に他から起動不可となっている訳ではない。

■前提
Sprint4での検討では、エラー等での切り戻しは考慮しない。
その為、2面管理は行わず、概要③の面切り替えも行わない。
また、コマンドやSPPコンポーネント上でエラーとなった場合は、エラーの返却のみの為、データが不整合の状態となる可能性あり。

なお、データの上書きは許容しない。
その為、既に使用中の情報があれば、エラーとなる。

MACアドレスについて、現状マルチキャストやブロードキャストのアドレスの対応を行っていない為、
コマンドのパラメータにマルチキャストなどのアドレスが設定されてもチェックなどは行わず、そのまま設定する。
(Duplicateの対応で、マルチキャストなどを対応する場合に合わせてガード処理についても検討する予定。)

■データ
今回は既に存在するコア情報(struct spp_core_info)とIF情報(struct if_info)を使用する予定。
データの整合性チェックもコンフィグから読み込み後に使用しているチェック用の関数を流用して作成予定。

※上記構造体は下記ソースに存在。
spp_vf.h：31
struct spp_core_info {

spp_vf.c：39
struct if_info {

新規に以下のデータを追加する予定。
①MACアドレス情報(ハッシュ)
　MACアドレスからポートのIF種別とIF番号を取得可能なハッシュを作成。
　コマンドから管理情報へデータを設定する際に、MACアドレスの使用有無のチェックや、設定しているポートの情報を取得する予定。
　ハッシュの上限は、RTE_MAX_ETHPORTSの倍の予定。

②Classifierのデータ種別(enum)
　macのみ値を用意。
　現状はmacしかないが、パラメータ用に用意。

■(1)コマンド時の管理情報の更新方法
コマンド機能部がコマンドを受信した場合に、コマンドの内容を管理情報へ設定する設定用のAPIを提供する。
APIはコマンド毎に用意し、パラメータの変更やコマンドの新規追加等があった場合に、他コマンドへ影響が無い様にする。
APIの中でコマンドでの設定と既にある管理情報との整合性をチェックし、チェック結果は戻り値で返却する。
※整合性のチェックは、例えば、ポートであればポート追加(addコマンド)などで初期設定が完了しているか？他で使用中でないか？などのチェックを行う。

・外部IF
①プロセス番号取得(process)
戻り値　　　　　　：プロセス番号(0～128) ※最大値はCPUの上限を見越して128を想定。
起動パラメータで設定されたプロセス番号を返却する。

②ポート追加(add)
※Sprint4では作成しない予定。

③SPPコンポーネント設定(component)
※Sprint4では作成しない予定。

④Classifierテーブル追加(classifier_table)
パラメータ１[IN  ]：データ種別(種別値) ※■データの新規②のenumの値
パラメータ２[IN  ]：データ値(文字列)
パラメータ３[IN  ]：ポートのIF種別＋IF番号(構造体struct spp_config_port_info)
戻り値　　　　　　：OK(0)／その他NG(-1)／MACアドレス登録済み(-2)／MACアドレス登録なし(-3)／ポート設定なし(-4)／ポート使用中(-5)・・・他あれば追加 ※戻り値用のenumを用意する。
パラメータ１のデータ種別は現状macしか許容しない。
起動されると、新規に追加したMACアドレス情報にパラメータ２をKey・パラメータ３をdataとしたハッシュデータを追加する。
また、パラメータ３で指定されたポートのIF情報へMACアドレスを追加し、IF情報にコア情報が存在する場合はコア情報へもMACアドレスを追加する。
(Sprint4では2面管理しない為、使用面へ直接設定する。)
ポートのIF種別にUNDEFを設定して渡すことで削除する。

※戻り値
その他NG(-1)　　　　　 ：下記以外のエラー。
MACアドレス登録済み(-2)：MACアドレス追加時に対象のMACアドレスあり。
ポート未追加(-3)　　　 ：ポート追加(add)を実施していないポートへの設定。
ポート使用中(-4)　　　 ：他のMACアドレスが同じポートを使用中。


④設定反映(flush)
戻り値　　　　　　：OK(0)／NG(-1)
起動すると、他のコマンドで起動されたAPIで保持したコア情報を元に、
SPPコンポーネントから提供された更新用関数を起動する。

⑤転送開始(forward)
※Sprint4では作成しない予定。

⑥転送停止(stop)
※Sprint4では作成しない予定。

■(2)SPPコンポーネントが管理情報からデータを取得する方法
SPPコンポーネントへの更新は各コンポーネント側から更新用関数を提供してもらう事になった為、APIの提供は行わない。
SPPコンポーネントから提供される更新用関数に関連する仕様は、「#404_コンポーネント側設計.txt」を参照。

■(3)面切り替え
Sprint4では切り戻しを考慮しない為、2面管理を行わない為、面切り替えは行わない。
